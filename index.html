<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Magazin Bisericesc</title>
  <!-- Bootstrap pentru stilizări rapide -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* HEADER și FOOTER cu gradient de roșu închis */
    header, footer {
      background: linear-gradient(135deg, #4a0000, #a30000);
      color: #fff;
      padding: 10px 20px;
    }
    header img.logo { height: 50px; }
    nav ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    nav ul li a {
      color: #fff;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
    }
    .cart-icon { position: relative; display: inline-block; cursor: pointer; }
    .cart-icon img { height: 24px; }
    .cart-icon .badge {
      position: absolute; top: -5px; right: -10px;
      background: yellow; color: #000; border-radius: 50%;
      padding: 2px 6px; font-size: 0.8rem;
    }
    /* Container principal: fundal alb, margini, umbră și colțuri rotunjite */
    .main-container {
      background-color: #fff;
      margin: 20px auto;
      padding: 20px;
      max-width: 1200px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    /* Secțiuni delimitate cu linie roșie subțire */
    section {
      border-top: 3px solid #a30000;
      padding-top: 20px;
      margin-top: 20px;
    }
    /* Secțiuni de pagină cu tranziție (fade) */
    .page { opacity: 0; transition: opacity 0.5s ease; display: none; }
    .page.active-page { display: block; opacity: 1; }
    /* Carduri de produse – uniforme cu efect hover */
    .product-card {
      border: 1px solid #ccc;
      border-radius: 5px;
      overflow: hidden;
      background-color: #f8f9fa;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .product-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .product-card img {
      width: 100%; height: 200px; object-fit: cover; cursor: pointer;
    }
    .product-card .card-body { padding: 15px; flex-grow: 1; }
    /* Stil pentru filtrul de produse */
    #filter-input { max-width: 400px; margin-bottom: 20px; }
    footer { text-align: center; }
    /* Slider de produse pe pagina de start */
    .slider-container {
      overflow: hidden;
      position: relative;
      height: 150px;
      margin-top: 20px;
      opacity: 0.6;
    }
    .slider-track {
      display: flex;
      width: max-content;
      animation: slide 20s linear infinite;
    }
    .slider-track img {
      margin-right: 10px;
      height: 150px; width: auto; border-radius: 5px;
    }
    @keyframes slide {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    /* Responsive */
    @media (max-width: 768px) {
      nav ul { justify-content: center; }
      .main-container { margin: 10px; padding: 15px; }
      .product-card img { height: 150px; }
    }
    /* Stil pentru factura în fereastra de printare */
    .invoice {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    .invoice h2, .invoice p, .invoice table { margin: 0 0 10px; padding: 0; }
    .invoice table { width: 100%; border-collapse: collapse; }
    .invoice table, .invoice table th, .invoice table td { border: 1px solid #000; }
    .invoice table th, .invoice table td { padding: 5px; text-align: left; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="d-flex justify-content-between align-items-center flex-wrap">
    <div class="d-flex align-items-center">
      <img src="https://via.placeholder.com/150x50?text=Logo" alt="Logo" class="logo me-2">
      <span class="fs-4">Magazin Bisericesc</span>
    </div>
    <nav>
      <ul>
        <li><a onclick="navigateTo('home')">Acasă</a></li>
        <li><a onclick="navigateTo('produse')">Produse</a></li>
        <li><a onclick="navigateTo('despre')">Despre noi</a></li>
        <li><a onclick="navigateTo('termeni')">Termeni & Condiții</a></li>
        <li><a onclick="navigateTo('calendar')">Calendar</a></li>
        <li><a onclick="navigateTo('cos')">Coș</a></li>
        <li><a onclick="navigateTo('admin')">Admin</a></li>
      </ul>
    </nav>
    <div class="cart-icon" onclick="navigateTo('cos')">
      <img src="https://via.placeholder.com/24?text=🛒" alt="Coș">
      <span class="badge" id="cart-count">0</span>
    </div>
  </header>
  
  <!-- Timer dinamic până la Paști -->
  <div class="text-center py-2" style="background-color:#fff;">
    <span id="timer" class="fs-5 text-danger"></span>
  </div>
  
  <!-- CONȚINUT PRINCIPAL ÎNCADRAT -->
  <main class="main-container" id="content">
    <!-- Pagina de start -->
    <section id="home" class="page active-page">
      <div class="text-center py-5">
        <h1>Bine ați venit la Magazinul Bisericesc</h1>
        <p>Descoperă produsele noastre pentru momente de spiritualitate!</p>
        <button class="btn btn-dark" onclick="navigateTo('produse')">Vezi produsele</button>
        <!-- Slider cu imagini de produse -->
        <div class="slider-container">
          <div class="slider-track" id="slider-track"></div>
        </div>
      </div>
    </section>
    
    <!-- Pagina Produse -->
    <section id="produse" class="page">
      <h2 class="mb-4">Produsele noastre</h2>
      <input type="text" id="filter-input" class="form-control" placeholder="Caută produs..." onkeyup="filterProducts()">
      <div id="products-container" class="row"></div>
    </section>
    
    <!-- Pagina Detalii Produs -->
    <section id="produs" class="page">
      <div id="produs-container"></div>
      <div class="text-center mt-3">
        <button class="btn btn-secondary" onclick="navigateTo('produse')">Înapoi la Produse</button>
      </div>
    </section>
    
    <!-- Pagina Despre noi -->
    <section id="despre" class="page">
      <h2>Despre noi</h2>
      <p>
        Magazinul nostru Bisericesc a fost fondat din dorința de a oferi clienților produse autentice, care reflectă tradițiile și valorile spirituale. Ne mândrim cu atenția la detalii și cu serviciile dedicate, lucrând neîncetat pentru a asigura calitatea fiecărui obiect. Fiecare produs este ales cu grijă pentru a aduce inspirație și liniște în viața credincioșilor. Prin combinarea tehnologiei moderne cu respectul pentru moștenirea spirituală, ne propunem să creăm o experiență plăcută pentru toți utilizatorii. Vă invităm să explorați colecția noastră variată și să descoperiți povestea fiecărui obiect.
      </p>
    </section>
    
    <!-- Pagina Termeni și Condiții -->
    <section id="termeni" class="page">
      <h2>Termeni și Condiții</h2>
      <p>
        Vă rugăm să citiți cu atenție acești termeni și condiții înainte de a utiliza acest magazin online. Accesând site-ul, vă angajați să respectați toate regulile prezentate. Ne rezervăm dreptul de a modifica condițiile oricând, iar utilizarea continuă a platformei implică acceptarea acestor modificări. Datele colectate sunt folosite exclusiv pentru procesarea comenzilor și îmbunătățirea experienței clienților. Orice neînțelegere va fi soluționată prompt de echipa noastră de suport. Vă mulțumim că alegeți să faceți parte din comunitatea noastră și sperăm să aveți o experiență plăcută pe acest site.
      </p>
    </section>
    
    <!-- Pagina Calendar -->
    <section id="calendar" class="page">
      <h2>Calendar Creștin Ortodox – Aprilie</h2>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Ziua</th>
            <th>Sărbătoare</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>Intrarea în Post</td></tr>
          <tr><td>14</td><td>Sfântul Vasile</td></tr>
          <tr><td>30</td><td>-</td></tr>
        </tbody>
      </table>
    </section>
    
    <!-- Pagina Coș -->
    <section id="cos" class="page">
      <h2>Coșul de Cumpărături</h2>
      <div id="cart-container"></div>
      <div id="order-form" style="display:none;" class="mt-4">
        <h4>Date pentru comandă</h4>
        <div class="mb-3">
          <label>Nume:</label>
          <input type="text" id="customer-name" class="form-control">
        </div>
        <div class="mb-3">
          <label>Contact (Email/Telefon):</label>
          <input type="text" id="customer-contact" class="form-control">
        </div>
        <button class="btn btn-success" onclick="placeOrder()">Finalizează Comanda</button>
      </div>
    </section>
    
    <!-- Pagina Admin -->
    <section id="admin" class="page">
      <h2>Admin</h2>
      <div id="admin-content"></div>
    </section>
  </main>
  
  <!-- FOOTER -->
  <footer>
    <p>&copy; <span id="year"></span> Magazin Bisericesc. Toate drepturile rezervate.</p>
    <img src="https://via.placeholder.com/100x30?text=ANPC" alt="Logo ANPC">
  </footer>
  
  <!-- JAVASCRIPT -->
  <script>
    /* Funcție de tranziție între pagini (fade) */
    function navigateTo(pageId) {
      const current = document.querySelector('.active-page');
      if (current) {
        current.style.opacity = 0;
        setTimeout(() => {
          current.classList.remove('active-page');
          const target = document.getElementById(pageId);
          target.classList.add('active-page');
          target.style.opacity = 0;
          setTimeout(() => { target.style.opacity = 1; }, 50);
        }, 500);
      } else {
        const target = document.getElementById(pageId);
        target.classList.add('active-page');
        target.style.opacity = 1;
      }
      if (pageId === 'admin') loadAdmin();
      if (pageId === 'produse') fetchProductsFromBackend();
    }
    
    document.getElementById('year').textContent = new Date().getFullYear();
    
    /* Timer dinamic până la Paști (ex: 20 aprilie 2025) */
    function startTimer() {
      let easterDate = new Date("2025-04-20T00:00:00").getTime();
      let timerElem = document.getElementById("timer");
      setInterval(() => {
        let now = new Date().getTime();
        let distance = easterDate - now;
        let days = Math.floor(distance / (1000 * 60 * 60 * 24));
        let hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        let minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        let seconds = Math.floor((distance % (1000 * 60)) / 1000);
        if (distance > 0) {
          timerElem.textContent = "Timp până la Paști: " + days + "z " + hours + "h " + minutes + "m " + seconds + "s";
        } else {
          timerElem.textContent = "Sărbătoarea a început! Următoarea se anunță în curând.";
        }
      }, 1000);
    }
    startTimer();
    
    /* ---- Produse și Stocuri ---- */
    // Lista de produse (datele de bază, restul stocurilor vor fi actualizate din backend)
    const products = [
      {id: 1, name: "Lumânare Roșie", price: 10.00, image: "https://via.placeholder.com/400x200?text=Produs+1", description: "Lumânare din ceară naturală pentru rugăciune.", stock: 50},
      {id: 2, name: "Lumânare Albă", price: 9.50, image: "https://via.placeholder.com/400x200?text=Produs+2", description: "Lumânare tradițională pentru biserică.", stock: 40},
      {id: 3, name: "Icoană Sfântă", price: 25.50, image: "https://via.placeholder.com/400x200?text=Produs+3", description: "Icoană lucrată manual.", stock: 30},
      {id: 4, name: "Carte de Rugăciuni", price: 15.75, image: "https://via.placeholder.com/400x200?text=Produs+4", description: "Carte cu rugăciuni și imnuri.", stock: 60},
      {id: 5, name: "Tămâie", price: 8.00, image: "https://via.placeholder.com/400x200?text=Produs+5", description: "Tămâie de înaltă calitate.", stock: 80},
      {id: 6, name: "Candele Decorative", price: 12.50, image: "https://via.placeholder.com/400x200?text=Produs+6", description: "Candele cu design elegant.", stock: 70},
      {id: 7, name: "Cruce Mică", price: 18.00, image: "https://via.placeholder.com/400x200?text=Produs+7", description: "Cruce din lemn sculptat.", stock: 35},
      {id: 8, name: "Amuletă", price: 7.50, image: "https://via.placeholder.com/400x200?text=Produs+8", description: "Amuletă de protecție.", stock: 45},
      {id: 9, name: "Set Rugăciuni", price: 20.00, image: "https://via.placeholder.com/400x200?text=Produs+9", description: "Set complet de rugăciuni.", stock: 55},
      {id: 10, name: "Simbol Bisericesc", price: 11.00, image: "https://via.placeholder.com/400x200?text=Produs+10", description: "Simbol al credinței.", stock: 50},
      {id: 11, name: "Lumânare Decorativă", price: 13.00, image: "https://via.placeholder.com/400x200?text=Produs+11", description: "Lumânare cu design modern.", stock: 60},
      {id: 12, name: "Icoană Mică", price: 16.00, image: "https://via.placeholder.com/400x200?text=Produs+12", description: "Icoană personală pentru rugăciuni.", stock: 40},
      {id: 13, name: "Carte de Sfinți", price: 14.25, image: "https://via.placeholder.com/400x200?text=Produs+13", description: "Carte cu vieți de sfinți.", stock: 30},
      {id: 14, name: "Candele Aromatice", price: 9.75, image: "https://via.placeholder.com/400x200?text=Produs+14", description: "Candele cu arome plăcute.", stock: 45},
      {id: 15, name: "Tablou Icoanic", price: 30.00, image: "https://via.placeholder.com/400x200?text=Produs+15", description: "Tablou religios elegant.", stock: 20},
      {id: 16, name: "Breloc cu Cruce", price: 5.50, image: "https://via.placeholder.com/400x200?text=Produs+16", description: "Breloc simbolic.", stock: 100},
      {id: 17, name: "Iconar Decorative", price: 22.00, image: "https://via.placeholder.com/400x200?text=Produs+17", description: "Set de iconar pentru casă.", stock: 25},
      {id: 18, name: "Vază cu Cruce", price: 17.50, image: "https://via.placeholder.com/400x200?text=Produs+18", description: "Vază decorativă cu motive religioase.", stock: 30},
      {id: 19, name: "Candelabru", price: 26.00, image: "https://via.placeholder.com/400x200?text=Produs+19", description: "Candelabru pentru slujbe.", stock: 15},
      {id: 20, name: "Set de Rugăciune", price: 19.00, image: "https://via.placeholder.com/400x200?text=Produs+20", description: "Set complet cu accesorii de rugăciune.", stock: 40}
    ];
    
    // Funcție pentru a prelua stocurile actualizate din backend
    function fetchProductsFromBackend() {
      fetch('backend.php?action=get_products')
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") {
            data.products.forEach(bp => {
              const prod = products.find(p => p.id === bp.id);
              if (prod) prod.stock = bp.stock;
            });
            renderProducts();
          }
        });
    }
    
    // Renderizează cardurile de produse în secțiunea "produse"
    function renderProducts() {
      const container = document.getElementById('products-container');
      container.innerHTML = "";
      const filterValue = document.getElementById('filter-input').value.toLowerCase();
      products.forEach(prod => {
        if (prod.name.toLowerCase().includes(filterValue)) {
          const col = document.createElement('div');
          col.className = "col-md-4 mb-4";
          col.innerHTML = `
            <div class="product-card h-100">
              <img src="${prod.image}" alt="${prod.name}" onclick="viewProduct(${prod.id})">
              <div class="card-body">
                <h5>${prod.name}</h5>
                <p>Preț: ${prod.price.toFixed(2)} Lei</p>
                <p>Stoc: <span id="stock-${prod.id}">${prod.stock}</span></p>
              </div>
              <div class="p-2">
                <div class="input-group" style="max-width:120px;">
                  <input type="number" id="qty-${prod.id}" value="1" min="1" class="form-control">
                  <button class="btn btn-danger btn-sm" onclick="addToCart(${prod.id}, 'list')">Adaugă</button>
                </div>
              </div>
            </div>
          `;
          container.appendChild(col);
        }
      });
    }
    
    // Filtrează produsele
    function filterProducts() { renderProducts(); }
    
    // Afișează detaliile unui produs
    function viewProduct(id) {
      const prod = products.find(p => p.id === id);
      if (!prod) return;
      const container = document.getElementById('produs-container');
      container.innerHTML = `
        <div class="row">
          <div class="col-md-6">
            <img src="${prod.image}" alt="${prod.name}" class="img-fluid">
          </div>
          <div class="col-md-6">
            <h2>${prod.name}</h2>
            <p>${prod.description}</p>
            <p><strong>Preț:</strong> ${prod.price.toFixed(2)} Lei</p>
            <p><strong>Stoc disponibil:</strong> <span id="detail-stock-${prod.id}">${prod.stock}</span></p>
            <div class="input-group" style="max-width:120px;">
              <input type="number" id="detail-qty-${prod.id}" value="1" min="1" class="form-control">
              <button class="btn btn-danger" onclick="addToCart(${prod.id}, 'detail')">Adaugă</button>
            </div>
          </div>
        </div>
      `;
      navigateTo('produs');
    }
    
    // Adaugă produsul în coș și actualizează stocul local
    function addToCart(id, source = 'list') {
      const qtyInput = (source === 'list') ? document.getElementById(`qty-${id}`) : document.getElementById(`detail-qty-${id}`);
      let qty = parseInt(qtyInput.value) || 1;
      const prod = products.find(p => p.id === id);
      if (prod.stock < qty) { alert("Nu există suficient stoc!"); return; }
      prod.stock -= qty;
      document.getElementById(`stock-${id}`) && (document.getElementById(`stock-${id}`).textContent = prod.stock);
      document.getElementById(`detail-stock-${id}`) && (document.getElementById(`detail-stock-${id}`).textContent = prod.stock);
      let index = cart.findIndex(item => item.id === id);
      if (index > -1) { cart[index].quantity += qty; }
      else { cart.push({ id: id, quantity: qty }); }
      updateCartCount();
      alert(`Produsul "${prod.name}" a fost adăugat în coș.`);
    }
    
    // Actualizează afișarea coșului
    function updateCartCount() {
      let total = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cart-count').textContent = total;
      renderCart();
    }
    
    // Renderizează coșul (lista de produse) – Aici coșul rămâne local, iar la plasarea comenzii se face fetch
    function renderCart() {
      const container = document.getElementById('cart-container');
      if (cart.length === 0) {
        container.innerHTML = "<p>Coșul este gol.</p>";
        document.getElementById('order-form').style.display = "none";
        return;
      }
      let html = `<table class="table">
                    <thead>
                      <tr>
                        <th>Produs</th>
                        <th>Cantitate</th>
                        <th>Preț</th>
                        <th>Total</th>
                        <th>Acțiune</th>
                      </tr>
                    </thead>
                    <tbody>`;
      let grandTotal = 0;
      cart.forEach((item, index) => {
        let prod = products.find(p => p.id === item.id);
        let total = prod.price * item.quantity;
        grandTotal += total;
        html += `<tr>
                   <td>${prod.name}</td>
                   <td>${item.quantity}</td>
                   <td>${prod.price.toFixed(2)}</td>
                   <td>${total.toFixed(2)}</td>
                   <td><button class="btn btn-warning btn-sm" onclick="removeFromCart(${index})">Șterge</button></td>
                 </tr>`;
      });
      html += `<tr>
                 <td colspan="3" class="text-end"><strong>Total General:</strong></td>
                 <td colspan="2"><strong>${grandTotal.toFixed(2)} Lei</strong></td>
               </tr>`;
      html += `</tbody></table>`;
      container.innerHTML = html;
      document.getElementById('order-form').style.display = "block";
    }
    
    // Elimină un produs din coș și recuperează stocul
    function removeFromCart(index) {
      const removed = cart.splice(index, 1)[0];
      const prod = products.find(p => p.id === removed.id);
      prod.stock += removed.quantity;
      document.getElementById(`stock-${prod.id}`) && (document.getElementById(`stock-${prod.id}`).textContent = prod.stock);
      document.getElementById(`detail-stock-${prod.id}`) && (document.getElementById(`detail-stock-${prod.id}`).textContent = prod.stock);
      updateCartCount();
    }
    
    // Plasează comanda folosind backend.php (actualizează global comenzile și stocurile)
    function placeOrder() {
      const name = document.getElementById('customer-name').value.trim();
      const contact = document.getElementById('customer-contact').value.trim();
      if (name === "" || contact === "") { alert("Completează datele de contact!"); return; }
      if (cart.length === 0) { alert("Coșul este gol!"); return; }
      let orderTotal = cart.reduce((sum, item) => {
        const prod = products.find(p => p.id === item.id);
        return sum + (prod.price * item.quantity);
      }, 0);
      let order = {
        id: Date.now(),
        customer: { name, contact },
        items: [...cart],
        total: orderTotal
      };
      fetch('backend.php?action=place_order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ order: order })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          alert("Comanda a fost plasată. Mulțumim, " + name + "!");
          cart = [];
          updateCartCount();
          document.getElementById('customer-name').value = "";
          document.getElementById('customer-contact').value = "";
          // Actualizează stocurile din backend
          fetchProductsFromBackend();
          navigateTo('home');
        } else {
          alert("Eroare: " + data.message);
        }
      });
    }
    
    /* ---- Funcționalități pentru Admin ---- */
    let adminLogged = false;
    
    function loadAdmin() {
      const adminDiv = document.getElementById('admin-content');
      if (!adminLogged) {
        adminDiv.innerHTML = `
          <h4>Login Admin</h4>
          <div class="mb-3">
            <label>Utilizator:</label>
            <input type="text" id="admin-user" class="form-control">
          </div>
          <div class="mb-3">
            <label>Parolă:</label>
            <input type="password" id="admin-pass" class="form-control">
          </div>
          <button class="btn btn-primary" onclick="adminLogin()">Login</button>
        `;
      } else {
        adminDiv.innerHTML = `
          <h4>Dashboard Admin</h4>
          <h5>Filtrare Produse</h5>
          <input type="text" id="admin-filter" class="form-control mb-3" placeholder="Caută produs în admin..." onkeyup="renderAdminProducts()">
          <div id="admin-products-container" class="mb-4"></div>
          <h5>Comenzi Plasate</h5>
          <div id="admin-orders-container"></div>
          <button class="btn btn-secondary mt-3" onclick="adminLogout()">Logout</button>
        `;
        renderAdminProducts();
        renderOrders();
      }
    }
    
    function adminLogin() {
      const user = document.getElementById('admin-user').value.trim();
      const pass = document.getElementById('admin-pass').value.trim();
      if (user === "admin" && pass === "parola123") { adminLogged = true; loadAdmin(); }
      else { alert("Autentificare eșuată!"); }
    }
    
    function adminLogout() { adminLogged = false; loadAdmin(); }
    
    // Renderizează produsele în secțiunea Admin cu opțiunea de a seta noul stoc
    function renderAdminProducts() {
      const container = document.getElementById('admin-products-container');
      container.innerHTML = "";
      const filter = document.getElementById('admin-filter').value.toLowerCase();
      products.forEach(prod => {
        if (prod.name.toLowerCase().includes(filter)) {
          const prodHTML = `
            <div class="mb-2 p-2" style="border:1px solid #ccc; border-radius:5px;">
              <strong>${prod.name}</strong> - Stoc: <span id="admin-stock-${prod.id}">${prod.stock}</span>
              <input type="number" id="new-stock-${prod.id}" placeholder="Nou stoc" style="width:70px; margin-left:10px;">
              <button class="btn btn-warning btn-sm ms-2" onclick="updateProductStockCustom(${prod.id})">Setează stoc</button>
            </div>
          `;
          container.innerHTML += prodHTML;
        }
      });
    }
    
    // Actualizează stocul pentru un produs în baza valorii introduse de admin
    function updateProductStockCustom(id) {
      const newStock = parseInt(document.getElementById(`new-stock-${id}`).value) || 0;
      fetch('backend.php?action=update_stock_custom', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ product_id: id, new_stock: newStock })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          alert("Stocul a fost actualizat.");
          fetchProductsFromBackend();
          renderAdminProducts();
        } else {
          alert("Eroare: " + data.message);
        }
      });
    }
    
    // Renderizează comenzile din backend în secțiunea Admin
    function renderOrders() {
      fetch('backend.php?action=get_orders')
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById('admin-orders-container');
          if (data.status !== "success" || data.orders.length === 0) {
            container.innerHTML = "<p>Nu există comenzi.</p>";
            return;
          }
          let html = `<table class="table">
                        <thead>
                          <tr>
                            <th>ID Comandă</th>
                            <th>Client</th>
                            <th>Detalii Produse</th>
                            <th>Total</th>
                            <th>Acțiuni</th>
                          </tr>
                        </thead>
                        <tbody>`;
          data.orders.forEach((order, idx) => {
            let details = "";
            order.items.forEach(item => {
              const prod = products.find(p => p.id === item.id);
              details += prod.name + " x " + item.quantity + "<br>";
            });
            html += `<tr>
                       <td>${order.id}</td>
                       <td>${order.customer.name}<br>${order.customer.contact}</td>
                       <td>${details}</td>
                       <td>${order.total.toFixed(2)} Lei</td>
                       <td>
                         <button class="btn btn-success btn-sm" onclick="finishOrder(${idx})">Terminată</button>
                         <button class="btn btn-info btn-sm" onclick="printInvoice(${idx})">Tipărește Factura</button>
                       </td>
                     </tr>`;
          });
          html += `</tbody></table>`;
          container.innerHTML = html;
        });
    }
    
    // Marchează o comandă ca terminată
    function finishOrder(index) {
      // Pentru simplitate, aici nu se realizează o actualizare backend; ar trebui un endpoint de ștergere în backend
      alert("Funcționalitate de finalizare comandă de integrat în backend real.");
    }
    
    // Deschide fereastra pentru tipărirea facturii
    function printInvoice(index) {
      fetch('backend.php?action=get_orders')
        .then(res => res.json())
        .then(data => {
          if (data.status !== "success" || data.orders.length <= index) return;
          const order = data.orders[index];
          let invoiceWindow = window.open("", "PrintInvoice", "width=800,height=600");
          let htmlContent = `
            <html>
            <head>
              <title>Factura - Comanda ${order.id}</title>
              <style>
                body { font-family: Arial, sans-serif; padding: 20px; }
                h2, p, table { margin: 0 0 10px; padding: 0; }
                table { width: 100%; border-collapse: collapse; }
                table, th, td { border: 1px solid #000; }
                th, td { padding: 5px; text-align: left; }
              </style>
            </head>
            <body>
              <h2>Factura - Comanda ${order.id}</h2>
              <p><strong>Client:</strong> ${order.customer.name}</p>
              <p><strong>Contact:</strong> ${order.customer.contact}</p>
              <table>
                <thead>
                  <tr>
                    <th>Produs</th>
                    <th>Cantitate</th>
                    <th>Preț</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>`;
          order.items.forEach(item => {
            const prod = products.find(p => p.id === item.id);
            const total = prod.price * item.quantity;
            htmlContent += `<tr>
                              <td>${prod.name}</td>
                              <td>${item.quantity}</td>
                              <td>${prod.price.toFixed(2)}</td>
                              <td>${total.toFixed(2)}</td>
                            </tr>`;
          });
          htmlContent += `</tbody>
              </table>
              <p><strong>Total Comandă:</strong> ${order.total.toFixed(2)} Lei</p>
            </body>
            </html>`;
          invoiceWindow.document.write(htmlContent);
          invoiceWindow.document.close();
          invoiceWindow.focus();
          invoiceWindow.print();
        });
    }
    
    // La încărcarea paginii, se preiau stocurile din backend și se generează sliderul
    document.addEventListener("DOMContentLoaded", function() {
      fetchProductsFromBackend();
      renderSlider();
    });
  </script>
  <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
